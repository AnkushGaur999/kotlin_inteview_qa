### Coroutines:

## üß† What are Coroutines?
Coroutines are a way to write **asynchronous** (non-blocking) code **in a simple, readable way**, without using threads manually.

Think of them as **lightweight threads** that you can pause (`suspend`) and resume without blocking your app.

---

## 1Ô∏è‚É£ Suspend Functions

### üîπ What is a suspend function?
A `suspend` function is **just like a normal function**, but it can **pause** its work **without blocking** the whole app. 
It must be called from a coroutine or another suspend function.

### ‚úÖ Example:
```kotlin
suspend fun downloadData(): String {
    delay(2000) // Waits for 2 seconds (does not block)
    return "Data downloaded"
}
```

To use it:
```kotlin
import kotlinx.coroutines.*

fun main() = runBlocking {
    println("Downloading...")
    val result = downloadData()
    println(result)
}
```

### üßæ Output:
```
Downloading...
(2 seconds delay)
Data downloaded
```

üß† `delay()` is a suspend function that doesn‚Äôt block the thread. Think of it like `Thread.sleep()`, but better and non-blocking.

---

## 2Ô∏è‚É£ Coroutine Builders

These are functions to **start a coroutine**.

### üîπ launch
- Starts a coroutine that **does not return a value**.
```kotlin
launch {
    // some background work
}
```

### üîπ async
- Starts a coroutine that **returns a value**.
```kotlin
val result = async {
    // returns something
}
```

### üîπ runBlocking
- Blocks the current thread and waits for coroutines to finish.
- Use only in **main function** or **unit tests**.

---

### ‚úÖ launch Example:
```kotlin
fun main() = runBlocking {
    launch {
        delay(1000)
        println("Inside launch")
    }
    println("Outside launch")
}
```

üßæ Output:
```
Outside launch
Inside launch
```

### ‚úÖ async Example:
```kotlin
fun main() = runBlocking {
    val result = async {
        delay(1000)
        "Result from async"
    }
    println("Waiting for result...")
    println(result.await())
}
```

---

## 3Ô∏è‚É£ CoroutineScope and Dispatchers

### üîπ CoroutineScope
- It defines how long your coroutine lives.
- When the scope is cancelled, all coroutines inside are cancelled too.

### üîπ Dispatchers
Control where (on which thread) your code runs:
- `Dispatchers.Main`: Main/UI thread
- `Dispatchers.IO`: For reading files, database, network
- `Dispatchers.Default`: For CPU-heavy tasks
- `Dispatchers.Unconfined`: Runs immediately in the current thread

---

### ‚úÖ Dispatcher Example:
```kotlin
fun main() = runBlocking {
    launch(Dispatchers.IO) {
        println("Running on: ${Thread.currentThread().name}")
    }
}
```

üßæ Output:
```
Running on: DefaultDispatcher-worker-1 (or similar)
```

---

## 4Ô∏è‚É£ Exception Handling in Coroutines

You can use `try-catch` inside a coroutine to catch exceptions.

### ‚úÖ Example:
```kotlin
fun main() = runBlocking {
    try {
        launch {
            throw Exception("Something went wrong!")
        }.join()
    } catch (e: Exception) {
        println("Caught: ${e.message}")
    }
}
```

üß† Tip: `join()` waits for the coroutine to complete.

---

## 5Ô∏è‚É£ Structured Concurrency

Structured concurrency ensures:
- Coroutines **run in a defined scope**.
- When the scope ends, all coroutines are **automatically cancelled**.

### ‚úÖ Example:
```kotlin
fun main() = runBlocking {
    launch {
        delay(1000)
        println("Child coroutine done")
    }
    println("Parent scope done")
}
```

üß† If you cancel the parent (`runBlocking`), the child coroutine is cancelled too.

---

## Summary Table

| Concept                | Description                               | Use Case                     |
|------------------------|-------------------------------------------|------------------------------|
| `suspend`              | Can pause and resume                      | Network call, delay          |
| `launch`               | Start coroutine (no result)               | Fire and forget tasks        |
| `async`                | Start coroutine (returns value)           | Concurrent tasks with result |
| `runBlocking`          | Runs blocking coroutine (main/tests only) | Entry point or tests         |
| `Dispatchers.IO`       | Background work like network, DB          | File I/O, API call           |
| `Dispatchers.Main`     | UI updates                                | Update UI from coroutine     |
| `try-catch`            | Handle exceptions                         | Catch error in coroutine     |
| Structured Concurrency | Auto-cancels child coroutines             | Safe and clean cancellation  |

---